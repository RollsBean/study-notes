# 垃圾回收算法
## 6.1 理解 Throughout 回收器
Throughout 比较简单，所以先理解 Throughout 回收器。

垃圾回收器3个必要的步骤：找到不使用的对象、释放它们的内存，以及压缩堆。Throughout 可以在同一个 GC 周期内完成所有这些操作，这些操作合在一起被
称为**回收**。

Throughout 新生代回收：Eden 被填满，新生代回收发生，新生代所有对象移除 Eden 空间，一部分移动到 Survivor 空间，一部分移动到老年代。

## 6.2 理解 G1 垃圾回收器
G1 GC（garbage first）垃圾优先回收。G1 中也分有新生代和老年代，不过新生代和老年代也是用 region 定义的，默认共有 2048个 region，方便调整分代大小。G1 是一个并发回收器，
标记老年代中不使用的对象和应用程序线程同时发生。但 G1 不是完全并发的，因为新生代的**标记**和**压缩**需要暂停所有应用程序线程，**老年代压缩**也是在应用程序
暂停期间发生的。

G1 GC 有4个逻辑操作：
1. 新生代回收
2. 后台并发标记周期
3. 混合回收
4. 必要的 Full GC

#### 并发标记周期
并发周期需要注意：
1. 期间可能发生多次新生代回收，因此前面的 Eden 空间可能已经被释放
2. 一些区域被标记为 X。这些区域属于老年代，标记周期已经判定这些区域里的大部分数据是垃圾。
3. 在这个周期结束后，老年代空间（O 和 X）可能变多了，因为此步骤仅标记，不回收。

G1 的并发标记有多个阶段，有些阶段会暂停所有的应用程序线程，有些不会。第一个阶段在 JDK8 中称为**初始标记**（initial mark），在 JDK11 中被称
为**并发开始**（concurrent start）。这个阶段会暂停所有应用线程。在 JDK11 中，还有个 Humongous 巨型对象区域。

标记后是重新标记（remark）阶段和正常的清理（cleanup）阶段。这两个阶段会 STW，不过时间比较短。

这之后，G1 会执行一系列的 Mixed GC（混合垃圾回收）

#### Mixed GC 混合回收
Mixed GC 周期将执行多次，持续到几乎所有标记的区域都完成回收。

