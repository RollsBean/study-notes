# 第一章 状态化流处理概述

## 传统数据处理架构

Apache Flink 是一个分布式流处理引擎。Flink 于 2014 年 4 月以孵化项目的形式进入 Apache 软件基金会，并在次年称为定级项目。

Flink 源自 2010 年前后德国的三所高效合作研究的 Stratosphere 项目，后于 2014 年加入 Apache 基金会。作为 Apache Flink 社区的 PMC 成员，
作者 Fabian 和 Visia 从从起就参与了项目设计研发。

## 事务型处理

常规的数据库处理（OLTP），很多时候，多个应用会共享一个数据库系统。

### 分析型处理

不同于事务型数据库系统，分析型主要为业务运营提供分析等。

对于分析类查询，我们通常不会直接在事务型数据库上执行，而是将数据复制到一个专门用来护理分析类查询的数据仓库。

## 状态化流处理

几乎所有数据都是以连续事件流的形式产生。

任何一个处理事件流的应用，如果要支持跨多条记录的转行操作，都必须是有状态的，即能够存储和访问中间结果。状态有多种可选的存储位置，例如：程序变量、本地
文件、嵌入式或外部数据库等。

Apache Flink 会将应用状态存储在本地内存或嵌入式数据库中。由于采用了分布式架构，Flink 需要对本地状态予以保护。为了实现该特性，Flink 会定期将应用
状态的一致性检查点（checkpoint）写入远程持久化存储。

### 事件驱动型应用

事件驱动型应用是一类通过接受事件流触发特定应用业务逻辑的有状态的流式应用。

事件驱动型应用的典型应用场景有：

* 实时推荐
* 模式识别或复杂事件处理
* 异常检测

### 数据管道

有状态的流处理应用的一个日常用例是以低延迟的方式获取、转换并插入数据，我们称此类应用为数据管道。

### 流式分析

ETL 作业会周期性地把数据导入存储系统，并通过查询处理数据。这属于批处理。数据会有一定的延迟。

流式分析应用不再需要等待周期性地触发。它以极低延迟整合最新事件，从而可以不断更新结果。而且传统分析往往需要很多独立组件，但是流处理引擎会全面负责事件
获取。此外，它还能以精确一次的状态一致性保障进行故障修复，调节应用计算资源等。

流式分析应用常用于：

* 手机网络质量监控
* 移动应用中的用户行为分析
* 消费者技术中心的实时数据即席分析

## 开源流处理的演变

数据流处理并非是一项新技术。

### 历史回顾

第一代开源分布式流处理引擎（2011年）专注于低延迟并保证数据不丢失。但是数据可能被处理多次，而且是通过牺牲结果的准确性来换取低延迟的。

Lambda 架构：

![Lambda arch](../../image/bigData/基于Apache%20Flink的流处理/Lambda%20arch.png)

Lambda 架构在传统周期性批处理架构的基础上加了一个由低延迟流处理引擎所驱动的"提速层"。在该架构中，数据会同时发往流处理引擎和写入批量存储。

第二代引擎（2013年）提供了更加完善的故障处理机制，即使出现故障，也能保证记录只参与一次结果运算。但是它的改进是以增加处理延迟为代价的。

第三代引擎（2015年）解决了结果对事件到来事件及顺序的依赖问题。真正意义上的计算精确一致结果的计算引擎。并且它既满足高吞吐又满足低延迟，使得 Lambda 
架构彻底沦为历史。

## Flink 快览

Flink 优点：

* 同时支持事件时间和处理时间语义。事件时间语义能对无序事件提供一致、精确的结果；处理时间语义能够用在具有极低延迟需求的应用中。
* 提供精确一次（exactly-once）的状态一致性保障。
* 每秒处理百万条事件并保持毫秒级延迟。可以扩展到数千核心之上。
* 层次化的API和SQL。
* 用于最常见的存储系统连接器，如 Kafka、ES、JDBC等。
* 支持高可用配置，和 Kubernetes、YARN、Apache Mesos 紧密继承，快速故障恢复，动态扩容收缩作业等。
* 允许不丢失应用状态的前提下更新作业的程序代码，或跨Flink 集群的作业迁移。
* 提供详细、可自由定制的系统以及应用指标集合，用于提前定位和相应问题。
* Flink 也是一个成熟的批处理引擎（正在努力发证成一个批流统一的系统）。

