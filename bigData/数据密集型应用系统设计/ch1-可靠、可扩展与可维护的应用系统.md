# 第一部分 数据系统基础

# 第 1 章 可靠、可扩展与可维护的应用系统

当今许多应用都是数据密集型（data-intensive）应用。许多应用系统都包含以下模块：

* **数据库**：用以存储数据，这样之后应用可以再次访问。
* **高速缓存**：缓存那些复杂或操作代价昂贵的结果，用于加快下次访问速度。
* **索引**：用户可以按关键字搜索数据并支持各种过滤。
* **流式处理**：持续发送消息到另一个进程，处理采用异步方式。
* **批处理**：定期处理累积数据。

## 认识数据系统

本书将专注于三个问题：

_可靠性（Reliability）_  
&nbsp;&nbsp;&nbsp;&nbsp;当出现故障时，程序能正常运行。虽然性能有所降低，但可以确保功能正确。

_可扩展性（Scalability）_  
&nbsp;&nbsp;&nbsp;&nbsp;当数据量、流量增加后，系统可以进行扩展。

_可维护性（Maintainability）_  
&nbsp;&nbsp;&nbsp;&nbsp;易于维护。

## 可靠性

可能出错的事情成为错误或故障。

### 硬件故障

硬件故障包括硬盘崩溃、内存故障、电网停电或者其他问题。研究表明硬盘平均无故障时间大约是 10~50 年。一般通过增加硬件冗余来减少故障率，比如为磁盘配置
RAID，服务器配双电源等。现在通过软件容错的方式来容忍多机失效成为新的额手段。

### 软件故障

软件故障更难预料，比如输入某个特定时服务器会崩溃，使用共享资源问题，依赖的外部服务响应变慢等。软件系统问题有时无法快速解决，只能进行测试找出问题所在。

### 人为失误

很多错误都是运维配置导致的，而硬件故障一般只占少数。可以采用以下方法增加可靠性：

* 以最小出错方式来设计系统。
* 想办法分离出最容易出错的地方。比如提供一个沙箱环境供客户体验，不影响线上环境。
* 充分测试。
* 使用监控系统监控各项指标。
* 规范统一的迭代流程。
* 可回滚的恢复机制。

## 可扩展性

### 描述负载

**负载**可以用称为负载参数的若干数字来描述。例如 Web 服务取得 QPS（每秒查询请求数），数据库写入比例。

### 描述性能

吞吐量（throughout），即每秒可处理的记录条数，或运行作业的总时间；系统响应时间（response time）。

### 应对负载增加的方法

监控那些请求比较慢的接口。

## 可维护性

关注三个设计原则：

_可运维性_

_简单性_  
&nbsp;&nbsp;&nbsp;&nbsp;简化系统复杂性。

_可演化性_  
&nbsp;&nbsp;&nbsp;&nbsp;也称为可延伸性、易修改性。

### 可运维性：运维更轻松

* 监控系统的健康状态。
* 追踪问题原因。例如系统故障等。
* 保持软件为最新稳定状态，例如安全补丁。
* 预测未来可能的问题。
* 了解不同系统如何相互影响。

### 简单性：简化复杂度

项目过于复杂会拖慢开发效率，增加了维护成本。复杂性有很多表现形式：状态空间的膨胀、模块紧耦合，不一致的命名和术语，特殊的处理或为解决某问题引入的特殊
框架等。

消除意外复杂性最好手段之一是抽象。一个好的抽象可以隐藏大量的实现细节，并对外提供干净、易懂的接口。

### 可演化性：易于改变

需求会不断变化，系统需要易于改变，敏捷开发模式适合应对这种开发模式。


